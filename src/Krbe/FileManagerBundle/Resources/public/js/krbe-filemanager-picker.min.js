document.addEventListener("DOMContentLoaded",function(){let s={wrapperClass:"krbe-filemanager-wrapper",inputAttribute:"data-krbe-filemanager",inputText:"Choisir un fichier",inputClass:"krbe-filemanager-input",buttonSelectText:"Choisir un fichier",buttonSelectClass:"krbe-filemanager-select-btn",buttonResetText:"Réinitialiser",buttonResetClass:"krbe-filemanager-reset-btn",previewClass:"krbe-filemanager-preview"};function t(a){if("true"!==a.dataset.filemanagerInitialized){a.dataset.filemanagerInitialized="true",a.id||(a.id=(()=>{var t="abcdefghijklmnopqrstuvwxyz0123456789";let n="krbe-filemanager-";for(let e=0;e<10;e++)n+=t.charAt(Math.floor(Math.random()*t.length));return n})()),a.readOnly=!0;let t=document.createElement("div");t.className=s.wrapperClass;var e=null,e=("img"===a.getAttribute(s.inputAttribute)&&((e=document.createElement("div")).className=s.previewClass,t.appendChild(e)),document.createElement("button"));e.type="button",e.textContent=s.buttonSelectText,e.className=s.buttonSelectClass,e.setAttribute("role","button"),e.setAttribute("tabindex","0");let n=document.createElement("button");function i(e){e.preventDefault(),(e=document.getElementById("filemanager-modal"))&&(e.style.display="block",e.dataset.targetInput=a.id,e.dataset.isImage="img"===a.getAttribute(s.inputAttribute))}function r(){a.value="";var e=t.querySelector("."+s.previewClass),e=(e&&(e.innerHTML=""),n.style.display="none",new CustomEvent("krbeFileManager:reset",{detail:{input:a}}));a.dispatchEvent(e)}function l(){n.style.display=a.value?"block":"none"}n.type="button",n.textContent=s.buttonResetText,n.className=s.buttonResetClass,n.setAttribute("role","button"),n.setAttribute("tabindex","0"),a.classList.add(s.inputClass),a.setAttribute("tabindex","0"),a.setAttribute("placeholder",s.inputText),e.addEventListener("click",i),e.addEventListener("touchend",i),n.addEventListener("click",r),n.addEventListener("touchend",function(e){e.preventDefault(),r()}),a.addEventListener("click",i),a.addEventListener("touchend",i),new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"value"===e.attributeName&&l()})}).observe(a,{attributes:!0}),l(),a.parentNode.insertBefore(t,a),t.appendChild(a),t.appendChild(n),t.appendChild(e)}}function n(){document.querySelectorAll(`input[${s.inputAttribute}]`).forEach(e=>t(e))}window.KrbeFileManagerConfig&&Object.assign(s,window.KrbeFileManagerConfig),window.KrbeFileManager={setConfig:function(e){Object.assign(s,e),n()}},document.addEventListener("click",function(e){e.target&&e.target.classList.contains("filemanager-modal-close")&&(e=document.getElementById("filemanager-modal"))&&(e.style.display="none",delete e.dataset.targetInput,delete e.dataset.isImage)}),document.addEventListener("touchend",function(e){e.target&&e.target.classList.contains("filemanager-modal-close")&&(e.preventDefault(),e=document.getElementById("filemanager-modal"))&&(e.style.display="none",delete e.dataset.targetInput,delete e.dataset.isImage)}),window.addEventListener("message",function(e){var t,n,a,i;console.log("Message reçu:",e.data),e.origin?e.data&&"filemanager:select"===e.data.type&&(console.log("Sélection de fichier détectée:",e.data),(t=document.getElementById("filemanager-modal"))?(n=t.dataset.targetInput,(a=document.getElementById(n))?(console.log("Input trouvé:",a.id),a.value=e.data.publicPath,"true"===t.dataset.isImage&&(i=a.closest("."+s.wrapperClass))&&(i=i.querySelector("."+s.previewClass))&&(i.innerHTML=`<img src="${e.data.publicPath}" alt="Preview" style="max-width: 100%; max-height: 100%; object-fit: contain;">`),(i=a.parentElement.querySelector("."+s.buttonResetClass))&&(i.style.display="block"),i=new CustomEvent("krbeFileManager:selected",{detail:{input:a,selectedFilePath:e.data.publicPath}}),a.dispatchEvent(i)):console.error("Input non trouvé:",n),t.style.display="none",delete t.dataset.targetInput,delete t.dataset.isImage):console.error("Modal non trouvée")):console.warn("Message sans origine reçu")}),n(),new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&(e.matches(`input[${s.inputAttribute}]`)&&t(e),e.querySelectorAll)&&e.querySelectorAll(`input[${s.inputAttribute}]`).forEach(t)})})}).observe(document.body,{childList:!0,subtree:!0})});
//# sourceMappingURL=krbe-filemanager-picker.min.js.map
